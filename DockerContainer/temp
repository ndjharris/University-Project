services:
  ign-edg:
    image: inductiveautomation/ignition
    hostname: edg-gw
    ports:
      - 8888:8088
     # - 9943:8043
    volumes:
      - ./projects:/usr/local/bin/ignition/data/projects
      - ./tags:/usr/local/bin/ignition/data/tags
      - ./themes-icons:/usr/local/bin/ignition/data/modules/com.inductiveautomation.perspective/
      - ./gw-init/Edge.gwbk:/restore.gwbk
      -  edg-data:/usr/local/bin/ignition/data
      - ./gw-init/ignition-STD-dev-uuid.txt:/usr/local/bin/ignition/data/.uuid
      - ./gw-init/ignition-STD-dev-metro-keystore:/usr/local/bin/ignition/data/local/metro-keystore
      #- ./modules/MQTT-Engine-signed.modl:/usr/local/bin/ignition/user-lib/modules/MQTT-Engine.modl
      #- ./modules/MQTT-Distributor-signed.modl:/usr/local/bin/ignition/user-lib/modules/MQTT-Distributor.modl
    networks:
      - ign-edg
    environment:
      - IGNITION_EDITION=edge
      - GATEWAY_ADMIN_USERNAME=admin
      - GATEWAY_ADMIN_PASSWORD_FILE=/run/secrets/gateway-admin-password
      - DISABLE_QUICKSTART=true
      - ACCEPT_IGNITION_EULA=Y
      - GATEWAY_MODULES_ENABLED=opc-ua,tag-historian,reporting,perspective,siemens-drivers,symbol-factory,web-developer,web-browser
    secrets:
      - gateway-admin-password
    command: >
      -n Edge
      -r /restore.gwbk
      -m 1024
      --
      wrapper.java.initmemory=512
      -Dignition.allowunsignedmodules=true
    logging:
      driver: json-file
      options:
        max-size: 10m 
    
networks:
  ign-edg:
secrets:
  gateway-admin-password:
    file: ./secrets/GATEWAY_ADMIN_PASSWORD

volumes:
  edg-data:
